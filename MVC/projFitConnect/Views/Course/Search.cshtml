@section Styles {
    <style>
        .text-container {
            width: 500px;
            margin: 20px 0;
        }

        .text-folded {
            max-height: 100px;
            overflow: hidden;
            transition: max-height 0.5s ease;
            font-size: 20px;
        }

        .text-expanded {
            max-height: 1000px;
        }

        #toggleButton {
            background-color: transparent;
            border: none;
            color: blue;
            cursor: pointer;
            text-decoration: underline;
            padding: 0;
            font-size: 1em;
            margin-top: 10px;
        }

            #toggleButton:hover {
                text-decoration: none;
            }

        .container {
            display: flex;
            align-items: flex-start;
            flex-direction: row; /* Changed to row */
        }

        .carousel-container {
            flex: 1;
            margin-right: 20px; /* Adjusted margin for right placement */
        }


        .text-content {
            flex: 2;
        }

        .course-card-container {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        .course-card {
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 16px;
            text-align: left;
            background-color: #fff;
        }

            .course-card h2 {
                color: #00796B;
                font-size: 18px;
            }

            .course-card .detail {
                display: flex;
                align-items: center;
                margin: 8px 0;
            }

                .course-card .detail img {
                    width: 24px;
                    height: 24px;
                    margin-right: 8px;
                }

            .course-card .price {
                font-size: 24px;
                font-weight: bold;
                color: #388E3C;
                margin-top: 12px;
            }

        .divider {
            border-top: 1px solid #ddd;
            margin: 8px 0;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-self: flex-start;
            margin-top: 20px; /* Adjusted margin */
        }

        .button {
            display: inline-flex;
            align-items: center;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

            .button img {
                margin-right: 10px;
            }

        .gym {
            background-color: #EDF7F0;
            color: #2D9C75;
        }

        .buyCourse {
            background-color: #5FB878;
        }

        .coach {
            background-color: #5FB878;
        }

        #returnButton {
            background-color: transparent;
            border: 1px solid transparent;
            color: slategray;
            cursor: pointer;
            padding: 0;
            font-size: 24px;
            margin-top: 10px;
        }

            #returnButton:hover {
                text-decoration: none;
            }
        /*滑鼠覆蓋卡片效果*/
        .act {
            transition: transform 0.3s ease;
            cursor: pointer;
        }

            .act:hover {
                transform: scale(0.98);
            }
    </style>
    }

    <div style="padding-top: 120px;"></div>
    <div class="return-button">
        <button id="returnButton" onclick="goBack()">＜返回</button>
    </div>
    <div class="container" id="main_div">
        <div class="carousel-container">
        <div id="carouselExampleFade" class="carousel slide carousel-fade" data-bs-ride="carousel" style="height:50vh; ">
            <div class="carousel-inner" id="divimage">
                    <div class="carousel-item active">
                    <img src="https://i.gifer.com/embedded/download/VIja.gif" class="d-block w-100" alt="Tension Reset Technique Image 1">
                    </div>
                    <div class="carousel-item">
                    <img src="https://i.gifer.com/embedded/download/VIja.gif" class="d-block w-100" alt="Tension Reset Technique Image 2">
                    </div>
                    <div class="carousel-item">
                    <img src="https://i.gifer.com/embedded/download/VIja.gif" class="d-block w-100" alt="Tension Reset Technique Image 3">
                    </div>
                    <div class="carousel-item">
                    <img src="https://i.gifer.com/embedded/download/VIja.gif" class="d-block w-100" alt="Tension Reset Technique Image 4">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleFade" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="text-content">
        <h1 id="courseTitle" style="width: 500px;"><strong>[教練研習]「張力重置技術」｜【整人專家】整合人體訓練的專家</strong></h1>
            <div class="text-container">
                <div class="text-folded" id="textContent">
                    <span id="courseDescription">
                        「張力重置技術」(Tension Reset Technique)帶你了解軟組織、弄懂肌肉、筋膜組織緊繃張力背後的原理，以及該如何透過正確的組織排列、動作擺位，去影響肌肉骨骼張力，鬆動每一個節點，並擴及全身，達到整體張力平衡的狀態。
                    </span>
                </div>
                <button id="toggleButton">顯示更多</button>
            </div>
            <div class="course-card-container">
                <div class="course-card">
                    <h2>關於課程</h2>
                    <div class="detail">
                    <img src="https://cdn0.iconfinder.com/data/icons/users-android-l-lollipop-icon-pack/24/user-256.png" alt="Time">
                        <div>
                            <div>課程教練</div>
                            <div id="courseCoach"></div>
                        </div>
                    </div>
                <div class="divider"></div>
                <div class="detail">
                    <img src="https://img.icons8.com/ios-glyphs/30/00796B/clock--v1.png" alt="Time">
                    <div>
                        <div>上課時間</div>
                        <div id="courseDate">2024.1.07 (日)</div>
                        <div id="courseTime">課程時間為 09:30 - 18:00</div>
                    </div>
                </div>
                    <div class="divider"></div>
                    <div class="detail">
                        <img src="https://img.icons8.com/ios-glyphs/30/00796B/place-marker.png" alt="Location">
                        <div>
                            <div>上課地點</div>
                            <div id="courseLocation">雙北地區近捷運站健身房</div>
                            <div>課程前1周通知 (信件確認)</div>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <div class="detail">
                        <img src="https://img.icons8.com/ios-glyphs/30/00796B/money.png" alt="Price">
                        <div>
                            <div>課程價格</div>
                            <div class="price" id="coursePrice">7,990</div>
                        </div>
                    </div>
                </div>
                <div class="button-container">
                    <a href="https://localhost:7168/gym/" class="button gym" id="gymButton">
                        <img src="https://cdn0.iconfinder.com/data/icons/phosphor-fill-vol-3/256/house-fill-256.png" alt="Gym Icon" width="20">
                        瞭解場館
                    </a>
                    <a href="#" class="button buyCourse" id="addcartbtn">
                        <img src="https://cdn0.iconfinder.com/data/icons/phosphor-regular-vol-4/256/shopping-cart-256.png" alt="Buy Course Icon" width="20">
                        購買課程
                    </a>
                    <a href="https://localhost:7168/Trainer/" class="button coach" id="coachButton">
                        <img src="https://cdn0.iconfinder.com/data/icons/users-android-l-lollipop-icon-pack/24/user-256.png" alt="Coach Icon" width="20">
                        課程教練
                    </a>
                </div>
            </div>
        </div>
    </div>
<div id="section-home" class="section" tabindex="0">
    <div>
        <h2><strong>更多課程</strong></h2>
        <div id="courseRecommand" class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
                <div class="card h-100">
                    <img src="~/assets/img/portfolio/4.jpg" class="card-img-top" alt="Recommended Coach Image">
                    <div class="card-body">
                        <h5 class="card-title">123</h5>
                        <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                    </div>
                </div>
            </div>
            <!-- Add more cards as needed -->
        </div>
    </div>
</div>
    <div id="section-recommand" class="section" tabindex="0">
        <div>
            <h2><strong>推薦教練</strong></h2>
            <div id="coachRecommand" class="row row-cols-1 row-cols-md-3 g-4">
                <div class="col">
                    <div class="card h-100">
                        <img src="~/assets/img/portfolio/4.jpg" class="card-img-top" alt="Recommended Coach Image">
                        <div class="card-body">
                            <h5 class="card-title">Card title</h5>
                            <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                        </div>
                    </div>
                </div>
                <!-- Add more cards as needed -->
            </div>
        </div>
    </div>
<div class="modal" id="unloginlModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered m-auto">
        <div class="modal-content" style="position:relative;border-radius:15px;border-color:#FFECEC;">
            <div class="modal-body" style="background-color:#ECFFFF; padding:0; position:relative; border-radius:15px;">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="position:absolute; top:10px; right:10px;"></button>
                <p style="position:absolute; top:10%; left:50%; transform:translate(-50%, -50%); color:#003D79; text-shadow: 1px 1px 2px #D7FFEE; font-weight:900;font-size:2.5em;">尚未登入</p>
                <img src="https://cdn.pixabay.com/animation/2022/12/01/17/03/17-03-11-60_512.gif" alt="Failed" style="height:100%; width:100%; object-fit:cover; border-radius:15px;border-color:#ECFFFF;">
                <a href="https://localhost:7168/Home/Login" class="btn btn-primary" id="headtologin" style="position:absolute; top:90%; left:50%; transform:translate(-50%, -50%);">前往登入--></a>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="coursereserveModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" style="border-radius:10px; overflow:hidden;">
        <div class="modal-content" style="height:300px;width:400px;position:relative;border-radius:10px;border-color:#CECEFF;">
            <div class="modal-body" style="background-color:#ECFFFF; padding:0; position:relative; border-radius:10px;">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="position:absolute; top:10px; right:10px;"></button>
                <h5 style="position:absolute; top:10%; left:50%; transform:translate(-50%, -50%); color:#003D79; text-shadow: 1px 1px 2px #D9FFFF; font-weight:700;">預約課程成功!</h5>
                <img src="https://cdn.dribbble.com/users/1154535/screenshots/3288650/dribbble-success-2.gif" alt="success" style="height:100%; width:100%; object-fit:cover; border-radius:10px;border-color:#CECEFF;">
            </div>
        </div>
    </div>
</div>
<div class="modal" id="alreadyaddModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" style="border-radius:10px; overflow:hidden;">
        <div class="modal-content" style="height:300px;width:400px;position:relative;border-radius:20px;border-color:#CECEFF;">
            <div class="modal-body" style="background-color:#FFED97; padding:0; position:relative; border-radius:10px;">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="position:absolute; top:10px; right:10px;"></button>
                <h5 style="position:absolute; top:10%; left:50%; transform:translate(-50%, -50%); color:#272727; text-shadow: 1px 1px 2px #FFFFDF; font-weight:700;">已預約過此課程~</h5>
                <img src="https://cdn.dribbble.com/users/5669337/screenshots/13958426/light_bulb.gif" alt="Already" style="height:100%; width:100%; object-fit:cover; border-radius:20px;border-color:#CECEFF;">
            </div>
        </div>
    </div>
</div>
@{
    var loginMemberID = ViewBag.ID != null ? ViewBag.ID : 0;
}

@section Scripts {
    <script>
        const loginMemberID = @loginMemberID;
        console.log(@ViewBag.classScheduleId);
        const classScheduleId = '@ViewBag.classScheduleId';
        function showCoursereservModal() {
            const modal = new bootstrap.Modal(document.getElementById('coursereserveModal'));
            modal.show();
            setTimeout(() => {
                modal.hide();
            }, 2468);
        }
        function showAlreadyAddModal() {
            const modal = new bootstrap.Modal(document.getElementById('alreadyaddModal'));
            modal.show();
            setTimeout(() => {
                modal.hide();
            }, 999);
        }
        if (classScheduleId) {
            const newbtn = document.getElementById('addcartbtn');
            newbtn.addEventListener('click', async (event) => {
                if (loginMemberID === 0) {
                    const unloginlModal = new bootstrap.Modal(document.getElementById('unloginlModal'));
                    unloginlModal.show();
                    return;
                }
                event.preventDefault();
                const response = await fetch(`https://localhost:7199/api/ClassReserved/add/${loginMemberID}?schid=${classScheduleId}`, {
                    method: 'GET'
                });
                if (response.ok) {
                    showCoursereservModal();
                    //window.alert('新增課程成功!');
                } else {
                    showAlreadyAddModal();
                    //window.alert('該課程已在購物車內');
                }
            });
        }

        // 文字摺疊
        document.addEventListener('DOMContentLoaded', function () {
            const textContent = document.getElementById('textContent');
            const toggleButton = document.getElementById('toggleButton');

            toggleButton.addEventListener('click', function () {
                if (textContent.classList.contains('text-expanded')) {
                    textContent.classList.remove('text-expanded');
                    toggleButton.textContent = '顯示更多';
                } else {
                    textContent.classList.add('text-expanded');
                    toggleButton.textContent = '顯示更少';
                }
            });
        });

        // 返回上一頁
        function goBack() {
            window.history.back();
        }

        // 載入所選課程頁面
        const searchCourse = async () => {
            let URL = 'https://localhost:7199/api/Course/' + classScheduleId;
            let response = await fetch(URL);
            let data = await response.json();
            console.log('data-id', data);

            let { class: _name, introduction, coach: courseCoach, coachId, courseDate, gymId, gym, courseStartTime: t1, courseEndTime: t2, classPayment } = data[0];

            const Image = document.getElementById('divimage');
            const title = document.getElementById('courseTitle');
            const p1 = document.getElementById('courseDescription');
            const coach = document.getElementById('courseCoach');
            const date_span = document.getElementById('courseDate');
            const time_span = document.getElementById('courseTime');
            const place = document.getElementById('courseLocation');
            const price = document.getElementById('coursePrice');
            const gymButton = document.getElementById('gymButton');
            const coachButton = document.getElementById('coachButton');
            const coachRecommand = document.querySelector('#coachRecommand'); // 教練卡
            const courseRecommand = document.getElementById('courseRecommand'); // 課程卡

            // 顯示照片
            s = `<div class="carousel-item active">
               <div class="zoom-container">
                       <img src="data:image/jpeg;base64,${data[0].photo}" class="d-block w-500 h-400 zoom-img" alt="notFound" style="max-width: 700px; max-height: 500px; background-color: dimgrey;">
               </div>
           </div>
        `;

            if (data[0].images) {
                for (var pic of data[0].base64Images) {
                    s += `<div class="carousel-item">
                            <div class="zoom-container">
                                     <img src="data:image/jpeg;base64,${pic}" class="d-block w-500 h-400 zoom-img" alt="notFound" style="max-width: 700px; max-height: 500px; background-color: dimgrey;">
                            </div>
                     </div>`;
                }
            }

            Image.innerHTML = s;

            let dt = new Date(courseDate)
            let pay = classPayment
            let i = `${classPayment}`.length
            let gymid = gymId
            let coachid = coachId
            console.log('coachId', coachId)
            console.log('coachButton', coachButton)

            console.log('pay', pay)
          

            const year = dt.getFullYear();
            const month = dt.getMonth() + 1;
            const day = dt.getDate();

            if (i > 3) {
                pay = getnumber(pay)
            }

            title.textContent = _name
            p1.textContent = introduction +'健身能增強心肺功能，提升肌肉力量和耐力，有助於體重管理和維持健康體重。它還能改善心理健康，減少壓力、焦慮和抑鬱症狀，增強自信心和幸福感。規律運動有助於降低多種慢性病的風險，如心臟病、糖尿病和高血壓，促進整體健康。健身還能提高睡眠質量，使人精力充沛，增強免疫力，讓身體更有活力。'
            coach.textContent = courseCoach
            date_span.textContent = `${year}/${month < 10 ? '0' + month : month}/${day < 10 ? '0' + day : day}` + todate(dt.getDay())
            time_span.textContent = '課程時間為 ' + t1.toString().substring(0, 5) + ' - ' + t2.toString().substring(0, 5)
            place.textContent = gym
            price.textContent = '$' + pay
            gymButton.href = `https://localhost:7168/gym?id=${gymId}`;
            coachButton.href = `https://localhost:7168/Trainer/Coach?id=${coachId}`;
        };
        searchCourse();
        //載入推薦課程
        const recommandCourse = async () => {
            let sortBy = ["", "Date", "GymId"];
            let sortType = ["asc", "desc"];
            let randomNumber = Math.floor(Math.random() * 3);
            let randomNumber2 = Math.floor(Math.random() * 2);
            console.log(randomNumber);
            const url = 'https://localhost:7199/api/Course/SEARCH';
            const response = await fetch(url, {
                method: 'POST',
                body: JSON.stringify({
                    "sort1": 0,
                    "sort2": 0,
                    "field": "",
                    "courseDate": null,
                    "courseStartTime": null,
                    "keyword": "",
                    "page": 1,
                    "pageSize": 3,
                    "sortBy": sortBy[randomNumber],
                    "sortType": sortType[randomNumber2]
                }),
                headers: {
                    'Content-Type': 'application/json'
                }

            });
            data = await response.json();
            console.log('data',data);
            console.log('sortby',sortBy[randomNumber]);
            console.log('sorttype',sortType[randomNumber2]);

            const courseCard = data.courseResult.map(item => {
                return (`<a href="/course/search?id=${item.classScheduleId}" class="card mb-3 act" style="text-decoration:none; background-color:DimGrey; max-width: 400px;">
            <div class="card h-100" style="height: 320px;">
                <img src="data:image/jpeg;base64,${item.photo}" id="image" class="img-fluid rounded-start" alt="..." style="object-fit: cover; height: 200px; width: 100%;">
                <div class="card-body" style="padding: 15px;">
                    <h5 class="card-title" style="font-size: 1.2rem;"><strong>${item.class}</strong></h5>
                    <p class="card-text" style="font-size: 1rem;">${item.introduction}</p>
                </div>
            </div>
        </a>
        `)
            })
            courseRecommand.innerHTML = courseCard.join("");
        }
        recommandCourse();
        //載入推薦教練
        const recommandCoach = async () => {
            let sortBy = ["", "RegionId", "Sort1ID", "GenderID"];
            let sortType = ["asc", "desc"];
            let randomNumber = Math.floor(Math.random() * 4);
            let randomNumber2 = Math.floor(Math.random() * 2);
            console.log(randomNumber);
            const url = 'https://localhost:7199/api/Coach/SEARCH';
            const response = await fetch(url, {
                method: 'POST',
                body: JSON.stringify({
                    "sort1": "",
                    "sort2": "",
                    "gender": "",
                    "city": "",
                    "region": "",
                    "classId": 0,
                    "keyword": "",
                    "page": 1,
                    "pageSize": 3,
                    "sortBy": sortBy[randomNumber],
                    "sortType": sortType[randomNumber2]
                }),
                headers: {
                    'Content-Type': 'application/json'
                }

            });
            data = await response.json();
            console.log('data', data);
            console.log(sortBy[randomNumber]);
            console.log(sortType[randomNumber2]);
            //教練卡
            const coachCard = data.coachResult.map(item => {
                //專長(不重複)
                const uniqueExp = {};
                const exps = item.experties.map(exp => {
                    const key = exp.classSort2;
                    if (!uniqueExp[key]) {
                        uniqueExp[key] = true;
                        return '#'+exp.classSort2;
                    }
                    return null;
                    console.log(exp.classSort2);
                }).filter(exp => exp !== null).join(`<br>`);

                console.log(exps);
                //console.log(item.experties.classSort2)
                return (`<a href="/Trainer/Coach?id=${item.id}" class="card mb-3 act" style="text-decoration:none; background-color:DimGrey; max-width: 400px;">
            <div class="card h-100" style="height: 320px;">
                <img src="data:image/jpeg;base64,${item.photo}" id="image" class="img-fluid rounded-start" alt="..." style="object-fit: cover; height: 200px; width: 100%; object-position: top;">
                <div class="card-body" style="padding: 15px;">
                    <h5 class="card-title" style="font-size: 1.2rem;">${item.name}</h5>
                    <p class="card-text" style="font-size: 1rem;">${item.intro}</p>
                    <p class="card-text" style="font-size: 1rem;">${exps}</p>
                </div>
            </div>
        </a>

        `)
            })
            coachRecommand.innerHTML = coachCard.join("");
        }

        recommandCoach();
        //星期正規化
        function todate(d) {
            if (d === 1) {
                return '(一)'
            } else if (d === 2) {
                return '(二)'
            } else if (d === 3) {
                return '(三)'
            } else if (d === 4) {
                return '(四)'
            } else if (d === 5) {
                return '(五)'
            } else if (d === 6) {
                return '(六)'
            } else if (d === 0) {
                return '(日)'
            } else {
                return '沒這天啦!'
            }
        };

        //價格正規化
        function getnumber(txt) {
            var txt = `${txt}`
            let i = txt.length
            let j = parseInt('0')
            let num = ''
            let a = i % 3

            for (let k = 0; k < (i + a); k++) {
                if ((k - a) % 4 === 0) {
                    num += ','
                }
                else {
                    num += txt[j]
                    j++
                }
            }
            return num
        };

    </script>
}